@model IEnumerable<SmartPlant.Models.ViewModels.UserAdminViewModel>

@{
    ViewData["Title"] = "Manage Users";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container mt-4">
    <!-- Back to Manage Plants Link -->
    <div class="mb-3">
        <a asp-action="ManagePlants" class="text-decoration-none text-dark">
            <span style="font-size: 1.1rem;">&larr; Back to Manage Plants</span>
        </a>
    </div>

    <!-- Page Title -->
    <h2 class="text-center mb-4">Manage Users</h2>

    <!-- Users Table Container -->
    <div class="p-4" style="background-color: #d4e4d4; border: 1px solid #999;">

        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @TempData["Success"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        <!-- Search Box -->
        <div class="mb-3">
            <input type="text" id="searchBox" class="form-control" placeholder="Search by user name..." style="background-color: white; border: 1px solid #999; max-width: 400px;" />
        </div>

        @if (Model != null && Model.Any())
        {
            <table class="table table-bordered" id="usersTable" style="background-color: white;">
                <thead>
                    <tr style="background-color: #f0f0f0;">
                        <th>User Name</th>
                        <th>Email</th>
                        <th>Registered Plants</th>
                        <th>Role</th>
                        <th style="text-align: center;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        bool isEvenRow = false;
                    }
                    @foreach (var item in Model)
                    {
                        var rowColor = isEvenRow ? "#c8e6c9" : "white";
                        isEvenRow = !isEvenRow;

                        <tr style="background-color: @rowColor;">
                            <td>@item.Name @item.Surname</td>
                            <td>@item.Email</td>
                            <td>@item.PlantCount</td>
                            <td>
                                @if (item.Role == "Admin")
                                {
                                    <span class="badge" style="background-color: #dc3545; color: white;">Admin</span>
                                }
                                else
                                {
                                    <span class="badge" style="background-color: #6c757d; color: white;">User</span>
                                }
                            </td>
                            <td style="text-align: center;">
                                <a asp-action="ViewUser" asp-route-id="@item.Id" class="btn btn-sm" style="background-color: #4caf50; color: white;">View</a>
                                <form asp-action="DeleteUser" asp-route-id="@item.Id" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this user?');">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm" style="background-color: #f44336; color: white;">Delete</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="text-center py-5">
                <p class="mb-3">No users found.</p>
            </div>
        }
    </div>

    <!-- Extra spacing for footer -->
    <div style="height: 150px;"></div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchBox = document.getElementById('searchBox');
            const usersTable = document.getElementById('usersTable');

            if (searchBox && usersTable) {
                searchBox.addEventListener('keyup', function () {
                    const searchTerm = this.value.toLowerCase();
                    const tableRows = usersTable.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

                    for (let i = 0; i < tableRows.length; i++) {
                        const nameCell = tableRows[i].getElementsByTagName('td')[0];  // Name kolonu
                        const emailCell = tableRows[i].getElementsByTagName('td')[1]; // Email kolonu

                        if (nameCell && emailCell) {
                            const name = nameCell.textContent || nameCell.innerText;
                            const email = emailCell.textContent || emailCell.innerText;

                            // Name VEYA Email'de arama yap
                            if (name.toLowerCase().indexOf(searchTerm) > -1 ||
                                email.toLowerCase().indexOf(searchTerm) > -1) {
                                tableRows[i].style.display = '';
                            } else {
                                tableRows[i].style.display = 'none';
                            }
                        }
                    }
                });
            }
        });
    </script>
}
